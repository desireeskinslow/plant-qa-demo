<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Plant Q&A</title>
<style>
  :root{
    --bg:#000; --surface:#111; --text:#e7e7e7; --muted:#9aa0a6; --border:#222;
    --accent1:#1e90ff; --accent2:#3ea0ff; --radius:14px;
  }
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,sans-serif}
  .wrap{max-width:900px;margin:0 auto;padding:16px}

  header{text-align:center;margin-bottom:14px}
  h1{margin:0;font-size:22px}
  .sub{color:var(--muted);font-size:14px;margin-top:4px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;margin-top:12px}

  textarea{
    width:100%;min-height:100px;background:#000;color:var(--text);
    border:1px solid var(--border);border-radius:10px;padding:12px;font-size:16px;resize:vertical
  }
  .actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .btn{
    border:0;border-radius:10px;padding:12px 16px;font-size:15px;font-weight:600;cursor:pointer;color:#fff;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));flex:1 1 160px;min-width:140px
  }
  .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
  .hint{font-size:13px;color:var(--muted);margin-top:6px}

  .grid{display:grid;gap:12px;margin-top:14px}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

  .head{display:flex;justify-content:space-between;align-items:center}
  .chip{font-size:12px;color:var(--muted)}
  .answer{margin-top:8px;line-height:1.6}
  .muted{color:var(--muted)}
  ol{padding-left:20px;margin:8px 0 0}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸŒ¿ Plant Q&A</h1>
      <div class="sub">Ask about the plants. Side-by-side AI answers.</div>
    </header>

    <div class="card">
      <textarea id="q" placeholder="e.g., which need full sun? or if the low is 45Â°F, which should come inside?"></textarea>
      <div class="actions">
        <button id="askBtn" class="btn">Ask</button>
        <button id="previewBtn" class="btn ghost">Preview plants</button>
      </div>
      <div class="hint">Press <b>Enter</b> to Ask, <b>Shift+Enter</b> for a new line.</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="head"><h3>ðŸ§  Gemini</h3><span id="gmTime" class="chip"></span></div>
        <div id="gOut" class="answer muted">â€”</div>
      </div>
      <div class="card">
        <div class="head"><h3>ðŸ§¬ Python LLM</h3><span id="pyTime" class="chip"></span></div>
        <div id="pOut" class="answer muted">â€”</div>
      </div>
    </div>

    <div class="card">
      <div class="head"><h3>Preview</h3></div>
      <div id="previewHead" class="muted">â€”</div>
      <ol id="previewList" class="muted"></ol>
    </div>
  </div>

<script>
const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwE9GbNFgDx_QQVakFbX3uPWIZX2PyBlvLCX13ch67ob4q2jO6ghrRKd2gPjUBJzuU/exec';
const gOut = document.getElementById('gOut');
const pOut = document.getElementById('pOut');
const gmTime = document.getElementById('gmTime');
const pyTime = document.getElementById('pyTime');
const qEl = document.getElementById('q');
const previewHead = document.getElementById('previewHead');
const previewList = document.getElementById('previewList');

document.getElementById('askBtn').onclick = ask;
document.getElementById('previewBtn').onclick = previewPlants;
document.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey && e.target.id === 'q') { e.preventDefault(); ask(); }
});

function renderAnswer(t, el){ el.textContent=t||'â€”'; el.classList.toggle('muted',!t); }
function startCounter(el){ const t0=Date.now(); const id=setInterval(()=>{el.textContent=`â³ ${((Date.now()-t0)/1000).toFixed(1)}s`;},200); return {id,t0}; }
function stopCounter(el,t){ if(t){clearInterval(t.id); el.textContent=`â± ${((Date.now()-t.t0)/1000).toFixed(1)}s`; } }
function safeErr(e){return (e&&e.message)?e.message:String(e);}

async function api(action, params={}, {timeoutMs=30000}={}){
  const qs=new URLSearchParams({action,...params}).toString();
  const ctrl=new AbortController(); const timer=setTimeout(()=>ctrl.abort(new Error('timeout')),timeoutMs);
  try{
    const r=await fetch(`${GAS_API_URL}?${qs}`,{method:'GET',cache:'no-store',signal:ctrl.signal});
    const text=await r.text();
    let j; try{j=JSON.parse(text);}catch{throw new Error(`Bad JSON (${r.status})`);}
    if(j&&j.ok===false)throw new Error(j.error||'API error');
    return j;
  }finally{clearTimeout(timer);}
}

function ask(){
  const q=qEl.value.trim(); if(!q)return;
  renderAnswer('Thinkingâ€¦',gOut); renderAnswer('Thinkingâ€¦',pOut);
  const gt=startCounter(gmTime); const pt=startCounter(pyTime);

  api('ask_gemini',{q},{timeoutMs:30000})
    .then(r=>renderAnswer(r.answer||'(no answer)',gOut))
    .catch(e=>renderAnswer('Gemini error: '+safeErr(e),gOut))
    .finally(()=>stopCounter(gmTime,gt));

  api('ask_python',{q},{timeoutMs:45000})
    .then(r=>renderAnswer(r.answer||'(no answer)',pOut))
    .catch(e=>renderAnswer('Python error: '+safeErr(e),pOut))
    .finally(()=>stopCounter(pyTime,pt));
}

function previewPlants(){
  previewHead.textContent='Loadingâ€¦'; previewList.innerHTML='';
  api('preview',{}, {timeoutMs:15000})
    .then(o=>{
      previewHead.textContent=`Sheet: ${o.sheet} â€¢ ${o.count} plants`;
      previewList.innerHTML=(o.sample||[]).map(s=>`<li>${s}</li>`).join('');
      previewList.classList.remove('muted');
    })
    .catch(err=>{
      previewHead.textContent='Error: '+safeErr(err); previewList.innerHTML='';
    });
}
</script>
</body>
</html>
